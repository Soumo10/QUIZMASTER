<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="/static/style.css">
  <title>Take Quiz</title>
</head>

<body>
  <header class="header">
    {{ quiz.title }}
  </header>

  <div class="quiz-container">
    <div class="quiz-info">
      <div class="quiz-timer" id="timer">Time Remaining: <span id="time">00:00</span></div>
      <div class="quiz-subject">Subject: {{ quiz.subject.name }}</div>
      <div class="quiz-chapter">Chapter: {{ quiz.chapter.desc }}</div>
    </div>

    <form method="POST" action="{{ url_for('take_quiz', quiz_id=quiz.id) }}" id="quiz-form">
      {% for question in questions %}
      <div class="question-container">
        <div class="question-text">
          <p><strong>Q{{ loop.index }}:</strong> {{ question.question_text }}</p>
        </div>
        <div class="options-container">
          {% for option in question.options %}
          <div class="option">
            <input type="radio" id="option_{{ question.id }}_{{ option.id }}" 
                   name="question_{{ question.id }}" value="{{ option.id }}" required>
            <label for="option_{{ question.id }}_{{ option.id }}">{{ option.option_text }}</label>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}

      <div class="submit-container">
        <button type="submit" class="submit-button">Submit Quiz</button>
      </div>
    </form>
  </div>

  <script>
    // Set up timer based on quiz duration
    const duration = "{{ quiz.duration }}";
    const [hours, minutes] = duration.split(":");
    let totalSeconds = (parseInt(hours) * 60 * 60) + (parseInt(minutes) * 60);
    
    const timerElement = document.getElementById("time");
    const quizForm = document.getElementById("quiz-form");
    
    const timer = setInterval(() => {
      totalSeconds--;
      
      if (totalSeconds <= 0) {
        clearInterval(timer);
        alert("Time's up! Your quiz will be submitted automatically.");
        quizForm.submit();
      }
      
      const displayHours = Math.floor(totalSeconds / 3600);
      const displayMinutes = Math.floor((totalSeconds % 3600) / 60);
      const displaySeconds = totalSeconds % 60;
      
      timerElement.textContent = 
        `${String(displayHours).padStart(2, '0')}:${String(displayMinutes).padStart(2, '0')}:${String(displaySeconds).padStart(2, '0')}`;
    }, 1000);
  </script>
</body>

</html>